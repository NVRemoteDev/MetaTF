<% include header %>
    <% if(bpowner) { %>
      <h1><img src="<%= bpowner.avatarfull %>" /> <%= bpowner.personaname %>'s Backpack</h1>
    <%} else {%>
      <h1>Loading user's profile.</h1>
    <%}%>
    <% if (results) { %>
      <% var resultLength = results.length %>
      <p>
        Backpack Used/Total Slots: <%= resultLength %>/<%= bpslots %>
      </p>
      <% if(newItems === 'true') { %>
        <div class="row backpackrow newitem">
        <h3>New items:</h3>
        <% for (var y = 0; y < resultLength; y++) {
          if (results[y].isnew === 'new') {
            switch(results[y].quality) { 
              case 0: %> <div class="span2 normal backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 3: %> <div class="span2 vintage backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 8: %> <div class="span2 valve backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 5: %> <div class="span2 unusual backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 6: %> <div class="span2 unique backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 7: %> <div class="span2 community backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 9: %> <div class="span2 selfmade backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 1: %> <div class="span2 genuine backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 11: %> <div class="span2 strange backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
              <% case 13: %><div class="span2 haunted backgroundmodifiers" style="background-image:url(<%= results[y].image_url %>);background-size: contain;">
              <% break; %>
            <%}%>
            </div>
          <%}
        }
      }%>
      </div>
      <div class="row backpackrow">
      <h3>Backpack:</h3>
        <% var lastFound = 0; %>
        <% var currentFound = 0; %>
        <% var currentPage = 1; %>
        <% var usedASlot = 0; %>
        <% for (x = 0; x < resultLength; x++) { %>
          <% for (var i = 0; i < resultLength; i++) { %>
            <% if (results[i] !== undefined) { %>
              <% if (results[i].bpposition === x && results[i].isnew !== 'new') { %>
                <% currentFound = results[i].bpposition; %>
                <!-- Adds page number, accounts for empty slots between items -->
                <% while(currentFound > (lastFound + 1)) { %>
                  <div class="span2 normal backgroundmodifiers"></div>
                  <% ++usedASlot; %>
                  <% if (usedASlot % 50 === 0) { %>
                    <p>Page <%= ++currentPage %></p>
                  <%}%>
                  <% currentFound--; %>
                <% } %>
                <% usedASlot++ %>
                <% switch(results[i].quality) { 
                  case 0: %> <div class="span2 normal backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 3: %> <div class="span2 vintage backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 8: %> <div class="span2 valve backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastfound = results[i].bpposition; %>
                  <% break; %>
                  <% case 5: %> <div class="span2 unusual backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 6: %> <div class="span2 unique backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 7: %> <div class="span2 community backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 9: %> <div class="span2 selfmade backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 1: %> <div class="span2 genuine backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 11: %> <div class="span2 strange backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                  <% case 13: %><div class="span2 haunted backgroundmodifiers" style="background-image:url(<%= results[i].image_url %>);background-size: contain;">
                    <% lastFound = results[i].bpposition; %>
                  <% break; %>
                <%}%>
                </div>
                <% if (usedASlot % 50 === 0) { %>
                  <p>Page <%= ++currentPage %></p>
                <%}%>
              <%}%>
            <%}%>
          <%}%>
        <%}%>
        <!-- Account for blank slots, add page breaks when necessary -->
        <% while(lastFound < bpslots) { %>
          <div class="span2 normal backgroundmodifiers"></div>
          <% usedASlot++; %>
          <% if (usedASlot % 50 === 0) { %>
            <% if(lastFound + 1 !== bpslots) {%>
              <p>Page <%= ++currentPage %></p>
            <%}
          }
          lastFound++;
        }%>
        <% results = null; %>
        <% console.log("Finished rendering."); %>
      <% } else { %>
        <p>No results, or profile is private</p>
      <% } %>
    </div>
<% include footer %>